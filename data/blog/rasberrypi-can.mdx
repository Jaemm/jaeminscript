---
title: 'RasberryPi-CAN í†µì‹ '
date: '2023-12-10'
lastmod: '2023-12-10'
tags: ['RasberryPi']
draft: false
summary: 'CAN í†µì‹ ì´ë€?, CANí†µì‹  í™œì„±í™”'
images: ['/static/images/']
---

![rasberrypi logo image](/static/images/rasberrypi/rasberrypi-logo.svg)

<TOCInline toc={props.toc} exclude="Introduction" />

## 1. CAN í†µì‹ ì´ë€?

CAN(Controller Area Network)ì´ë€, ì°¨ëŸ‰ ë‚´ì—ì„œ í˜¸ìŠ¤íŠ¸ ì»´í“¨í„° ì—†ì´ ë§ˆì´í¬ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ì¥ì¹˜ë“¤ì´ ì„œë¡œ í†µì‹ í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ í‘œì¤€ í†µì‹  ê·œê²©ì…ë‹ˆë‹¤.

í•„ìëŠ” Raspiì—ì„œ CANí†µì‹ ì„ í•˜ê¸°ìœ„í•´ Waveshareì‚¬ì˜ RS485 CAN HATëª¨ë“ˆì„ ì‚¬ìš©í–ˆë‹¤.
ëª¨ë“ˆ ë§í¬ ì²¨ë¶€(https://www.waveshare.com/wiki/RS485_CAN_HAT)ğŸ‘ˆ
![rasberrypi can ëª¨ë“ˆ](/static/images/rasberrypi/rasberrypi-can.png)

## 2. CAN ëª¨ë“ˆ í™œì„±í™” ì„¤ì •

- config.txt íŒŒì¼ ìˆ˜ì •

```
sudo nano /boot/config.txt
```

- ì•„ë˜ ë‚´ìš© ì¶”ê°€

```
dtparam=spi=on
dtoverlay=mcp2515-can0,oscillator=12000000,interrupt=25,spimaxfrequency=2000000
```

## 3. CAN ì±„ë„ í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° ë‹¤ìš´ë¡œë“œ

```
sudo apt-get install can-utils
```

- í„°ë¯¸ë„ ì°½ì—ì„œ ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ ì…ë ¥ì‹œ CAN data Receive í•´ë³¼ìˆ˜ ìˆë‹¤.

```
candump can0
```

## 4. CAN í™œì„±í™”

```
sudo ip link set can0 up type can bitrate 125000
```

## 5. ì¥ì¹˜ í™•ì¸

- í„°ë¯¸ë„ ì°½ì—ì„œ ifconfigë¥¼ í†µí•´ì„œ ì¥ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ ê°™ì´ can0ê°€ í‘œì‹œë˜ë©´ ì •ìƒ ì¸ì‹ ëœê²ƒ.
![rasberrypi can ëª¨ë“ˆ ì¡°íšŒ](/static/images/rasberrypi/rasberrypi-can2.png)

## 6. ë¶€íŒ…ì‹œ ìë™ ì„¤ì •

- í•´ë‹¹íŒŒì¼ ì—´ê¸°

```
sudo nano /etc/network/interfaces
```

- ì•„ë˜ ë‚´ìš© ì¶”ê°€

```
auto can0
iface can0 can static
bitrate 125000
```

## 7. ì˜ˆì œì½”ë“œ

- Receive ì½”ë“œ(Python)

```
import os
import can

os.system('sudo ip link set can0 type can bitrate 100000')
os.system('sudo ifconfig can0 up')

can0 = can.interface.Bus(channel = 'can0', bustype = 'socketcan')# socketcan_native

#msg = can.Message(arbitration_id=0x123, data=[0, 1, 2, 3, 4, 5, 6, 7], is_extended_id=False)
msg = can0.recv(10.0)
print (msg)
if msg is None:
    print('Timeout occurred, no message.')

os.system('sudo ifconfig can0 down')
```

- Send ì½”ë“œ(Python)

```
import os
import can

os.system('sudo ip link set can0 type can bitrate 100000')
os.system('sudo ifconfig can0 up')

can0 = can.interface.Bus(channel = 'can0', bustype = 'socketcan')# socketcan_native

msg = can.Message(arbitration_id=0x123, data=[0, 1, 2, 3, 4, 5, 6, 7], is_extended_id=False)
can0.send(msg)

os.system('sudo ifconfig can0 down')
```
